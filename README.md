# Проект: Нейросеть для предсказания калорийности блюд

## Описание проекта

Данный проект представляет собой глубокую нейронную сеть для автоматического предсказания калорийности блюд на основе изображений, информации об ингредиентах и массе порции. Обучение было выполнено в google collab

**Цель проекта:** Разработать модель машинного обучения, способную оценить калорийность блюда с точностью MAE < 50 kcal на тестовой выборке.

## Датасет

Проект использует датасет, содержащий:
- **Изображения блюд** (RGB фотографии)
- **Информацию об ингредиентах** (списки ингредиентов для каждого блюда)
- **Массу порции** (в граммах)
- **Калорийность** (целевая переменная, в kcal)

Размер датасета: 1.3 ГБ

### Структура данных

```
data/
├── dish.csv              # Информация о блюдах
├── ingredients.csv       # Словарь ингредиентов
└── images/              # Директория с изображениями
    └── [dish_id]/
        └── rgb.png      # RGB изображение блюда
```

## Архитектура решения

### Модель

Проект использует **мультимодальную архитектуру**, объединяющую визуальные и табличные данные:

1. **Image Branch (EfficientNet-B0)**
   - Предобученная на ImageNet сверточная сеть
   - Извлекает признаки из изображений блюд
   - Выход: вектор размерности 1280

2. **Tabular Branch (MLP)**
   - Обрабатывает информацию об ингредиентах (multi-hot encoding)
   - Учитывает массу блюда
   - Выход: вектор размерности 128

3. **Fusion Module**
   - Объединяет признаки из обеих веток
   - Глубокая нейронная сеть с BatchNorm и Dropout

4. **Regression Head**
   - Финальный слой для предсказания калорийности

## Структура проекта

```
.
├── data/                    # Директория с данными (не включена в репозиторий)
│   ├── dish.csv
│   ├── ingredients.csv
│   └── images/
│
├── scripts/                # Python модули
│   ├── dataset.py          # Модуль для работы с данными
│   ├── inference.py        # Модуль для инференса обученной модели
│   └── utils.py            # Модуль для обучения модели
│
├── config.yaml             # Конфигурационный файл
├── notebook.ipynb          # Jupyter Notebook с EDA и экспериментами
├── model_best.pth          # Сохраненная модель (создается при обучении)
└── README.md               # Этот файл
```

## Установка и использование

### Подготовка данных

1. Скачайте датасет по [ссылке](https://disk.yandex.ru/d/kz9g5msVqtahiw)
2. Распакуйте данные в директорию `data/`
3. Убедитесь в наличии структуры:
   ```
   data/
   ├── dish.csv
   ├── ingredients.csv
   └── images/
   ```

### Конфигурация

Параметры обучения настраиваются в файле `config.yaml`:

```yaml
data:
  dish_csv: "data/dish.csv"
  ingredients_csv: "data/ingredients.csv"
  img_dir: "data/images"

model:
  pretrained: true
  save_path: "model_best.pth"

training:
  batch_size: 32
  epochs: 50
  learning_rate: 0.001
  weight_decay: 0.0001
  num_workers: 4

seed: 42
```

## Результаты

Модель успешно обучена и протестирована и сохранена как model_best.pth.

Результаты показывают, что мультимодальный подход, объединяющий визуальные и табличные признаки, эффективен для предсказания калорийности блюд.

Была достигнута точность MAE = 39.2000, что соответсвует тредуемой оценки в MAE < 50 и значит, что модель готова к интеграции в продукт.

Были выведены топ-5 самых тяжёлых примеров для модели, возможные причины ошибок:

- Некоторые блюда визуально похожи, но имеют разную калорийность
- Сложная композиция блюда с множеством компонентов
- Редкие комбинации ингредиентов
- Ингридиенты мало представлены в датасете
- Большое количество ингредиентов
- Выбросы по калорийности или массе
- Сложность в определении калорийности высокоэнергетических ингредиентов

### Метрики на тестовой выборке

| Метрика | Значение |
|---------|----------|
| **MAE** | **39.2 < 50 kcal** ✅ |
| RMSE | 65.2689 kcal |
| R² Score | 0.9052 |

